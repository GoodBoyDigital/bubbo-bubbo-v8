import{U as Z,T as x,E as f,e as A,a as $,R as _,b as k,s as v,L as b,p as T,c as B,d as S,G as ct,l as ut,r as pt,P as y,C as V,B as q,g as dt,M as ft,f as mt,u as gt,S as W}from"./index-c486d207.js";class Q{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Z.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?x.shared:new x,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Q.extension=f.Application;class J{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,n;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:o}=this._resizeTo;e=i,n=o}this.renderer.resize(e,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}J.extension=f.Application;A.add(J);A.add(Q);const F=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s};class tt extends ${constructor(t){super(),this.baseRenderedFontSize=100,this.baseMeasurementFontSize=100,this.pages=[],this.chars={},this.lineHeight=0,this.baseLineOffset=0,this.pages=[];const{textures:e,data:n}=t;Object.keys(n.pages).forEach(i=>{const o=n.pages[parseInt(i,10)],r=e[o.id];this.pages.push({texture:r})}),Object.keys(n.chars).forEach(i=>{const o=n.chars[i],r=e[o.page].source,a=new _(o.x/r.width,o.y/r.height,o.width/r.width,o.height/r.height),p=new k({source:r,layout:{frame:a}});this.chars[i]={id:i.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:p}}),this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontName=n.fontName,this.baseMeasurementFontSize=n.fontSize,this.baseRenderedFontSize=n.fontSize,this.distanceField=n.distanceField??{fieldType:"none",distanceRange:0}}destroy(){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture.destroy();this.chars=null;for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}}const L={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const c in t){const h=t[c].match(/^[a-z]+/gm)[0],m=t[c].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),d={};for(const N in m){const U=m[N].split("="),ht=U[0],X=U[1].replace(/"/gm,""),j=parseFloat(X),lt=isNaN(j)?X:j;d[ht]=lt}e[h].push(d)}const n={chars:{},pages:[],lineHeight:0,fontSize:0,fontName:"",distanceField:null,baseLineOffset:0},[i]=e.info,[o]=e.common,[r]=e.distanceField??[];r&&(n.distanceField={distanceRange:parseInt(r.distanceRange,10),fieldType:r.fieldType}),n.fontSize=parseInt(i.size,10),n.fontName=i.face,n.lineHeight=parseInt(o.lineHeight,10);const a=e.page;for(let c=0;c<a.length;c++)n.pages.push({id:parseInt(a[c].id,10)||0,file:a[c].file});const p={};n.baseLineOffset=n.lineHeight-parseInt(o.base,10);const u=e.char;for(let c=0;c<u.length;c++){const h=u[c],m=parseInt(h.id,10);let d=h.letter??h.char;d==="space"&&(d=" "),p[m]=d,n.chars[d]={id:m,page:parseInt(h.page,10)||0,x:parseInt(h.x,10),y:parseInt(h.y,10),width:parseInt(h.width,10),height:parseInt(h.height,10),xOffset:parseInt(h.xoffset,10),yOffset:parseInt(h.yoffset,10),xAdvance:parseInt(h.xadvance,10),kerning:{}}}const l=e.kerning||[];for(let c=0;c<l.length;c++){const h=parseInt(l[c].first,10),m=parseInt(l[c].second,10),d=parseInt(l[c].amount,10);n.chars[p[m]].kerning[p[h]]=d}return n}},G={test(s){const t=s;return"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontName:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],n=s.getElementsByTagName("common")[0],i=s.getElementsByTagName("distanceField")[0];i&&(t.distanceField={fieldType:i.getAttribute("fieldType"),distanceRange:parseInt(i.getAttribute("distanceRange"),10)});const o=s.getElementsByTagName("page"),r=s.getElementsByTagName("char"),a=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontName=e.getAttribute("face"),t.lineHeight=parseInt(n.getAttribute("lineHeight"),10);for(let u=0;u<o.length;u++)t.pages.push({id:parseInt(o[u].getAttribute("id"),10)||0,file:o[u].getAttribute("file")});const p={};t.baseLineOffset=t.lineHeight-parseInt(n.getAttribute("base"),10);for(let u=0;u<r.length;u++){const l=r[u],c=parseInt(l.getAttribute("id"),10);let h=l.getAttribute("letter")??l.getAttribute("char");h==="space"&&(h=" "),p[c]=h,t.chars[h]={id:c,page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xOffset:parseInt(l.getAttribute("xoffset"),10),yOffset:parseInt(l.getAttribute("yoffset"),10),xAdvance:parseInt(l.getAttribute("xadvance"),10),kerning:{}}}for(let u=0;u<a.length;u++){const l=parseInt(a[u].getAttribute("first"),10),c=parseInt(a[u].getAttribute("second"),10),h=parseInt(a[u].getAttribute("amount"),10);t.chars[p[c]].kerning[p[l]]=h}return t}},Y={test(s){return typeof s=="string"&&s.includes("<font>")?G.test(v.ADAPTER.parseXML(s)):!1},parse(s){return G.parse(v.ADAPTER.parseXML(s))}},vt=[".xml",".fnt"],yt={extension:f.CacheParser,test:s=>s instanceof tt,getCacheableAssets(s,t){const e={};return s.forEach(n=>{e[n]=t}),e[t.fontName]=t,e}},At={extension:{type:f.LoadParser,priority:b.Normal},test(s){return vt.includes(T.extname(s).toLowerCase())},async testParse(s){return L.test(s)||Y.test(s)},async parse(s,t,e){const n=L.test(s)?L.parse(s):Y.parse(s),{src:i}=t,{pages:o}=n,r=[];for(let l=0;l<o.length;++l){const c=o[l].file;let h=T.join(T.dirname(i),c);h=F(h,i),r.push(h)}const a=await e.load(r),p=r.map(l=>a[l]);return new tt({data:n,textures:p})},async load(s,t){return await(await v.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}},Et={extension:f.CacheParser,test:s=>Array.isArray(s)&&s.every(t=>t instanceof k),getCacheableAssets:(s,t)=>{const e={};return s.forEach(n=>{t.forEach((i,o)=>{e[n+(o===0?"":o+1)]=i})}),e}},Tt={extension:{type:f.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const s="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await v.ADAPTER.fetch(s).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},K=["png","jpg","jpeg"],Pt={extension:{type:f.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...K],remove:async s=>s.filter(t=>!K.includes(t))},bt="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function C(s){return bt?!1:document.createElement("video").canPlayType(s)!==""}const wt={extension:{type:f.DetectionParser,priority:0},test:async()=>C("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},_t={extension:{type:f.DetectionParser,priority:0},test:async()=>C("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},Mt={extension:{type:f.DetectionParser,priority:0},test:async()=>C("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},xt={extension:{type:f.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const s="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await v.ADAPTER.fetch(s).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")},kt=".json",It="application/json",Bt={extension:{type:f.LoadParser,priority:b.Low},name:"loadJson",test(s){return B(s,It)||S(s,kt)},async load(s){return await(await v.ADAPTER.fetch(s)).json()}},St=".txt",Dt="text/plain",Ot={name:"loadTxt",extension:{type:f.LoadParser,priority:b.Low},test(s){return B(s,Dt)||S(s,St)},async load(s){return await(await v.ADAPTER.fetch(s)).text()}},Lt=["normal","bold","100","200","300","400","500","600","700","800","900"],Ft=[".ttf",".otf",".woff",".woff2"],Rt=["font/ttf","font/otf","font/woff","font/woff2"],zt=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Ct(s){const t=T.extname(s),i=T.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let o=i.length>0;for(const a of i)if(!a.match(zt)){o=!1;break}let r=i.join(" ");return o||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}const Nt={extension:{type:f.LoadParser,priority:b.Low},name:"loadWebFont",test(s){return B(s,Rt)||S(s,Ft)},async load(s,t){var n,i,o;const e=v.ADAPTER.getFontFaceSet();if(e){const r=[],a=((n=t.data)==null?void 0:n.family)??Ct(s),p=((o=(i=t.data)==null?void 0:i.weights)==null?void 0:o.filter(l=>Lt.includes(l)))??["normal"],u=t.data??{};for(let l=0;l<p.length;l++){const c=p[l],h=new FontFace(a,`url(${encodeURI(s)})`,{...u,weight:c});await h.load(),e.add(h),r.push(h)}return r.length===1?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(t=>v.ADAPTER.getFontFaceSet().delete(t))}},Ut=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Xt=".svg",jt="image/svg+xml",Wt={extension:{type:f.LoadParser,priority:b.Low},name:"loadSVG",test(s){return B(s,jt)||S(s,Xt)},async testParse(s){return typeof s=="string"&&s.startsWith("data:image/svg+xml")||typeof s=="string"&&Ut.test(s)},async parse(s){const t=new ct;return t.svg(s),t},async load(s){return(await v.ADAPTER.fetch(s)).text()}};A.add(Et,Pt,Tt,xt,wt,_t,Mt,Bt,Ot,Nt,Wt,ut,pt,At,yt);const H={loader:f.LoadParser,resolver:f.ResolveParser,cache:f.CacheParser,detection:f.DetectionParser};A.handle(f.Asset,s=>{const t=s.ref;Object.entries(H).filter(([e])=>!!t[e]).forEach(([e,n])=>A.add(Object.assign(t[e],{extension:t[e].extension??n})))},s=>{const t=s.ref;Object.keys(H).filter(e=>!!t[e]).forEach(e=>A.remove(t[e]))});class Gt{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(x.system.add(this.tickerUpdate,this,Z.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(x.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const E=new Gt;class D{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=D.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new y,this.page=new y,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,i,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class I extends D{constructor(){super(...arguments),this.client=new y,this.movement=new y,this.offset=new y,this.global=new y,this.screen=new y}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,i,o,r,a,p,u,l,c,h,m,d,N){throw new Error("Method not implemented.")}}class g extends I{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class P extends I{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}P.DOM_DELTA_PIXEL=0;P.DOM_DELTA_LINE=1;P.DOM_DELTA_PAGE=2;const Yt=2048,Kt=new y,w=new y;class Ht{constructor(t){this.dispatch=new $,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((n,i)=>n.priority-i.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,i=e.length;n<i;n++)e[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){E.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",o=this[i](this.rootTarget,this.rootTarget.eventMode,Kt.set(t,e),this.hitTestFn,this.hitPruneFn);return o&&o[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,o=n.length-1;i<o;i++)if(t.currentTarget=n[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let i=n.length-2;i>=0;i--)if(t.currentTarget=n[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this._allInteractiveElements){if(n.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const i=Array.isArray(e)?e:[e];for(let o=n.length-1;o>=0;o--)i.forEach(r=>{t.currentTarget=n[o],this.notifyTarget(t,r)})}propagationPath(t){const e=[t];for(let n=0;n<Yt&&t!==this.rootTarget&&t.parent;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,n,i,o,r=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(E.pauseUpdate=!1),t.interactiveChildren&&t.children){const l=t.children;for(let c=l.length-1;c>=0;c--){const h=l[c],m=this.hitTestMoveRecursive(h,this._isInteractive(e)?e:h.eventMode,n,i,o,r||o(t,n));if(m){if(m.length>0&&!m[m.length-1].parent)continue;const d=t.isInteractive();(m.length>0||d)&&(d&&this._allInteractiveElements.push(t),m.push(t)),this._hitElements.length===0&&(this._hitElements=m),a=!0}}}const p=this._isInteractive(e),u=t.isInteractive();return u&&u&&this._allInteractiveElements.push(t),r||this._hitElements.length>0?null:a?this._hitElements:p&&!o(t,n)&&i(t,n)?u?[t]:[]:null}hitTestRecursive(t,e,n,i,o){if(this._interactivePrune(t)||o(t,n))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(E.pauseUpdate=!1),t.interactiveChildren&&t.children){const p=t.children,u=n;for(let l=p.length-1;l>=0;l--){const c=p[l],h=this.hitTestRecursive(c,this._isInteractive(e)?e:c.eventMode,u,i,o);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const m=t.isInteractive();return(h.length>0||m)&&h.push(t),h}}}const r=this._isInteractive(e),a=t.isInteractive();return r&&i(t,n)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!t||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,w),!t.hitArea.contains(w.x,w.y)))return!0;if(t.effects&&t.effects.length){let n=!1;for(let i=0;i<t.effects.length;i++){const o=t.effects[i];if(o.containsPoint){if(!o.containsPoint(e))return!1;n=!0}}return n}return!1}hitTestFn(t,e){var n;return t.eventMode==="passive"?!1:t.hitArea?!0:(n=t.view)!=null&&n.containsPoint?(t.worldTransform.applyInverse(e,w),t.view.containsPoint(w)):!1}notifyTarget(t,e){var o,r;e=e??t.type;const n=`on${e}`;(r=(o=t.currentTarget)[n])==null||r.call(o,t);const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof g)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const i=e.button===2;this.dispatchEvent(e,i?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var p,u;if(!(t instanceof g)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n=e.pointerType==="mouse"||e.pointerType==="pen",i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.overTargets);if(((p=i.overTargets)==null?void 0:p.length)>0&&o!==e.target){const l=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,l,o);if(this.dispatchEvent(c,"pointerout"),n&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(o)){const h=this.createPointerEvent(t,"pointerleave",o);for(h.eventPhase=h.AT_TARGET;h.target&&!e.composedPath().includes(h.target);)h.currentTarget=h.target,this.notifyTarget(h),n&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;this.freeEvent(h)}this.freeEvent(c)}if(o!==e.target){const l=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(e,l);this.dispatchEvent(c,"pointerover"),n&&this.dispatchEvent(c,"mouseover");let h=o==null?void 0:o.parent;for(;h&&h!==this.rootTarget.parent&&h!==e.target;)h=h.parent;if(!h||h===this.rootTarget.parent){const d=this.clonePointerEvent(e,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==o&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}const r=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?r.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&r.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?r.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&r.push("globaltouchmove")),n&&(this.moveOnAll?r.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&r.push("globalmousemove"),this.cursor=(u=e.target)==null?void 0:u.cursor),r.length>0&&this.all(e,r),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var r;if(!(t instanceof g)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.createPointerEvent(t),i=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(r=n.target)==null?void 0:r.cursor);const o=this.clonePointerEvent(n,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof g)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",i=this.findMountedTarget(e.overTargets),o=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(o),n&&this.dispatchEvent(o,"mouseout");const r=this.createPointerEvent(t,"pointerleave",i);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;e.overTargets=null,this.freeEvent(o),this.freeEvent(r)}this.cursor=null}mapPointerUp(t){if(!(t instanceof g)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const a=n.button===2;this.dispatchEvent(n,a?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.pressTargetsByButton[t.button]);let r=o;if(o&&!n.composedPath().includes(o)){let a=o;for(;a&&!n.composedPath().includes(a);){if(n.currentTarget=a,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const p=n.button===2;this.notifyTarget(n,p?"rightupoutside":"mouseupoutside")}a=a.parent}delete i.pressTargetsByButton[t.button],r=a}if(r){const a=this.clonePointerEvent(n,"click");a.target=r,a.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const p=i.clicksByButton[t.button];if(p.target===a.target&&e-p.timeStamp<200?++p.clickCount:p.clickCount=1,p.target=a.target,p.timeStamp=e,a.detail=p.clickCount,a.pointerType==="mouse"){const u=a.button===2;this.dispatchEvent(a,u?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof g)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(n){let o=n;for(;o;)i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof P)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const i=this.allocateEvent(g);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=n??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],typeof e=="string"&&(i.type=e),i}createWheelEvent(t){const e=this.allocateEvent(P);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(g);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof g&&e instanceof g&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof I&&e instanceof I&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const n=t.currentTarget._events[e];if(n&&t.currentTarget.isInteractive())if("fn"in n)n.once&&t.currentTarget.removeListener(e,n.fn,void 0,!0),n.fn.call(n.context,t);else for(let i=0,o=n.length;i<o&&!t.propagationImmediatelyStopped;i++)n[i].once&&t.currentTarget.removeListener(e,n[i].fn,void 0,!0),n[i].fn.call(n[i].context,t)}}const Zt=1,$t={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},R=class{constructor(s){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=s,this.rootBoundary=new Ht(null),E.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new g(null),this.rootWheelEvent=new P(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...R.defaultEventFeatures},{set:(t,e,n)=>(e==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),t[e]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(s){const{element:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e,R._defaultEventMode=s.eventMode??"passive",Object.assign(this.features,s.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(s){this.resolution=s}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(s){s=s||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===s)return;this.currentCursor=s;const e=this.cursorStyles[s];if(e)switch(typeof e){case"string":t&&(this.domElement.style.cursor=e);break;case"function":e(s);break;case"object":t&&Object.assign(this.domElement.style,e);break}else t&&typeof s=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,s)&&(this.domElement.style.cursor=s)}get pointer(){return this.rootPointerEvent}onPointerDown(s){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;const t=this.normalizeToPointerData(s);this.autoPreventDefault&&t[0].isNormalized&&(s.cancelable||!("cancelable"in s))&&s.preventDefault();for(let e=0,n=t.length;e<n;e++){const i=t[e],o=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(s){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;E.pointerMoved();const t=this.normalizeToPointerData(s);for(let e=0,n=t.length;e<n;e++){const i=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(s){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;let t=s.target;s.composedPath&&s.composedPath().length>0&&(t=s.composedPath()[0]);const e=t!==this.domElement?"outside":"",n=this.normalizeToPointerData(s);for(let i=0,o=n.length;i<o;i++){const r=this.bootstrapEvent(this.rootPointerEvent,n[i]);r.type+=e,this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(s){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;const t=this.normalizeToPointerData(s);for(let e=0,n=t.length;e<n;e++){const i=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(s){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(s);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(s){this.removeEvents(),this.domElement=s,E.domElement=s,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;E.addTickerListener();const s=this.domElement.style;s&&(globalThis.navigator.msPointerEnabled?(s.msContentZooming="none",s.msTouchAction="none"):this.supportsPointerEvents&&(s.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;E.removeTickerListener();const s=this.domElement.style;globalThis.navigator.msPointerEnabled?(s.msContentZooming="",s.msTouchAction=""):this.supportsPointerEvents&&(s.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(s,t,e){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},i=1/this.resolution;s.x=(t-n.left)*(this.domElement.width/n.width)*i,s.y=(e-n.top)*(this.domElement.height/n.height)*i}normalizeToPointerData(s){const t=[];if(this.supportsTouchEvents&&s instanceof TouchEvent)for(let e=0,n=s.changedTouches.length;e<n;e++){const i=s.changedTouches[e];typeof i.button>"u"&&(i.button=0),typeof i.buttons>"u"&&(i.buttons=1),typeof i.isPrimary>"u"&&(i.isPrimary=s.touches.length===1&&s.type==="touchstart"),typeof i.width>"u"&&(i.width=i.radiusX||1),typeof i.height>"u"&&(i.height=i.radiusY||1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="touch"),typeof i.pointerId>"u"&&(i.pointerId=i.identifier||0),typeof i.pressure>"u"&&(i.pressure=i.force||.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),typeof i.layerX>"u"&&(i.layerX=i.offsetX=i.clientX),typeof i.layerY>"u"&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=s.type,t.push(i)}else if(!globalThis.MouseEvent||s instanceof MouseEvent&&(!this.supportsPointerEvents||!(s instanceof globalThis.PointerEvent))){const e=s;typeof e.isPrimary>"u"&&(e.isPrimary=!0),typeof e.width>"u"&&(e.width=1),typeof e.height>"u"&&(e.height=1),typeof e.tiltX>"u"&&(e.tiltX=0),typeof e.tiltY>"u"&&(e.tiltY=0),typeof e.pointerType>"u"&&(e.pointerType="mouse"),typeof e.pointerId>"u"&&(e.pointerId=Zt),typeof e.pressure>"u"&&(e.pressure=.5),typeof e.twist>"u"&&(e.twist=0),typeof e.tangentialPressure>"u"&&(e.tangentialPressure=0),e.isNormalized=!0,t.push(e)}else t.push(s);return t}normalizeWheelEvent(s){const t=this.rootWheelEvent;return this.transferMouseData(t,s),t.deltaX=s.deltaX,t.deltaY=s.deltaY,t.deltaZ=s.deltaZ,t.deltaMode=s.deltaMode,this.mapPositionToPoint(t.screen,s.clientX,s.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=s,t.type=s.type,t}bootstrapEvent(s,t){return s.originalEvent=null,s.nativeEvent=t,s.pointerId=t.pointerId,s.width=t.width,s.height=t.height,s.isPrimary=t.isPrimary,s.pointerType=t.pointerType,s.pressure=t.pressure,s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist,this.transferMouseData(s,t),this.mapPositionToPoint(s.screen,t.clientX,t.clientY),s.global.copyFrom(s.screen),s.offset.copyFrom(s.screen),s.isTrusted=t.isTrusted,s.type==="pointerleave"&&(s.type="pointerout"),s.type.startsWith("mouse")&&(s.type=s.type.replace("mouse","pointer")),s.type.startsWith("touch")&&(s.type=$t[s.type]||s.type),s}transferMouseData(s,t){s.isTrusted=t.isTrusted,s.srcElement=t.srcElement,s.timeStamp=performance.now(),s.type=t.type,s.altKey=t.altKey,s.button=t.button,s.buttons=t.buttons,s.client.x=t.clientX,s.client.y=t.clientY,s.ctrlKey=t.ctrlKey,s.metaKey=t.metaKey,s.movement.x=t.movementX,s.movement.y=t.movementY,s.page.x=t.pageX,s.page.y=t.pageY,s.relatedTarget=null,s.shiftKey=t.shiftKey}};let O=R;O.extension={name:"events",type:[f.WebGLSystem,f.CanvasSystem,f.WebGPUSystem],priority:-1};O.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};const Vt={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(s){this.eventMode=s?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??O.defaultEventMode},set eventMode(s){this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,i=typeof t=="function"?void 0:t;s=n?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.on(s,t,i)},removeEventListener(s,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,i=typeof t=="function"?void 0:t;s=n?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.off(s,t,i)},dispatchEvent(s){if(!(s instanceof D))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};A.add(O);V.mixin(Vt);const M=class{constructor(s,t){this.linkedSheets=[],this._texture=s instanceof k?s:null,this.textureSource=s.source,this.textures={},this.animations={},this.data=t;const e=parseFloat(t.meta.scale);e?(this.resolution=e,s.source.resolution=this.resolution):this.resolution=s.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(s=>{this._callback=s,this._batchIndex=0,this._frameKeys.length<=M.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(s){let t=s;const e=M.BATCH_SIZE;for(;t-s<e&&t<this._frameKeys.length;){const n=this._frameKeys[t],i=this._frames[n],o=i.frame;if(o){let r=null,a=null;const p=i.trimmed!==!1&&i.sourceSize?i.sourceSize:i.frame,u=new _(0,0,Math.floor(p.w)/this.resolution,Math.floor(p.h)/this.resolution);i.rotated?r=new _(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):r=new _(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),i.trimmed!==!1&&i.spriteSourceSize&&(a=new _(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),a.x/=this.textureSource.width,a.y/=this.textureSource.height,a.width/=this.textureSource.width,a.height/=this.textureSource.height),r.x/=this.textureSource.width,r.y/=this.textureSource.height,r.width/=this.textureSource.width,r.height/=this.textureSource.height,u.x/=this.textureSource.width,u.y/=this.textureSource.height,u.width/=this.textureSource.width,u.height/=this.textureSource.height,this.textures[n]=new k({source:this.textureSource,layout:{frame:r,orig:u,trim:a,rotate:i.rotated?2:0,defaultAnchor:i.anchor},label:n})}t++}}_processAnimations(){const s=this.data.animations||{};for(const t in s){this.animations[t]=[];for(let e=0;e<s[t].length;e++){const n=s[t][e];this.animations[t].push(this.textures[n])}}}_parseComplete(){const s=this._callback;this._callback=null,this._batchIndex=0,s.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*M.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*M.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(s=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,s&&((t=this._texture)==null||t.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};let z=M;z.BATCH_SIZE=1e3;const qt=["jpg","png","jpeg","avif","webp"];function et(s,t,e){const n={};if(s.forEach(i=>{n[i]=t}),Object.keys(t.textures).forEach(i=>{n[i]=t.textures[i]}),!e){const i=T.dirname(s[0]);t.linkedSheets.forEach((o,r)=>{const a=et([`${i}/${t.data.meta.related_multi_packs[r]}`],o,!0);Object.assign(n,a)})}return n}const Qt={extension:f.Asset,cache:{test:s=>s instanceof z,getCacheableAssets:(s,t)=>et(s,t,!1)},resolver:{test:s=>{const e=s.split("?")[0].split("."),n=e.pop(),i=e.pop();return n==="json"&&qt.includes(i)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=v.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:f.LoadParser,priority:b.Normal},async testParse(s,t){return T.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var u,l;let n=T.dirname(t.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let i=n+s.meta.image;i=F(i,t.src);const r=(await e.load([i]))[i],a=new z(r.source,s);await a.parse();const p=(u=s==null?void 0:s.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(p)){const c=[];for(const m of p){if(typeof m!="string")continue;let d=n+m;(l=t.data)!=null&&l.ignoreMultiPack||(d=F(d,t.src),c.push(e.load({src:d,data:{ignoreMultiPack:!0}})))}const h=await Promise.all(c);a.linkedSheets=h,h.forEach(m=>{m.linkedSheets=[a].concat(a.linkedSheets.filter(d=>d!==m))})}return a},unload(s){s.destroy(!0)}}};A.add(Qt);const Jt=new q;function st(s,t,e){const n=Jt;s.measurable=!0,dt(s,e,n),t.addBoundsMask(n),s.measurable=!1}function nt(s,t,e){const n=new q;s.measurable=!0;const i=it(s,e,new ft);mt(s,n,i),s.measurable=!1,t.addBoundsMask(n)}function it(s,t,e){return s?(s!==t&&(it(s.parent,t,e),s.didChange&&gt(s.localTransform,s),e.append(s.localTransform)),e):(console.warn("Item is not inside the root container"),e)}class ot{constructor(t){this.priority=0,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof W),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){st(this.mask,t,e)}addLocalBounds(t,e){nt(this.mask,t,e)}containsPoint(t){const e=this.mask;return e.containsPoint?e.containsPoint(t):!1}destroy(){this.reset()}static test(t){return t instanceof W}}ot.extension=f.MaskEffect;class rt{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}rt.extension=f.MaskEffect;class at{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){st(this.mask,t,e)}addLocalBounds(t,e){nt(this.mask,t,e)}containsPoint(t){const e=this.mask;return e.containsPoint?e.containsPoint(t):!1}destroy(){this.reset()}static test(t){return t instanceof V}}at.extension=f.MaskEffect;A.add(ot,rt,at);
